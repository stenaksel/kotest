"use strict";(self.webpackChunkkotestdocs=self.webpackChunkkotestdocs||[]).push([[4479],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(n),d=o,h=u["".concat(c,".").concat(d)]||u[d]||m[d]||s;return n?r.createElement(h,a(a({ref:t},p),{},{components:n})):r.createElement(h,a({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var l=2;l<s;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},99899:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=n(87462),o=(n(67294),n(3905));const s={id:"mockserver",title:"MockServer",sidebar_label:"MockServer",slug:"mockserver.html"},a=void 0,i={unversionedId:"extensions/mockserver",id:"extensions/mockserver",title:"MockServer",description:"Kotest provides an extension for integration with the MockServer library.",source:"@site/docs/extensions/mockserver.md",sourceDirName:"extensions",slug:"/extensions/mockserver.html",permalink:"/docs/next/extensions/mockserver.html",draft:!1,editUrl:"https://github.com/kotest/kotest/blob/master/documentation/docs/extensions/mockserver.md",tags:[],version:"current",frontMatter:{id:"mockserver",title:"MockServer",sidebar_label:"MockServer",slug:"mockserver.html"},sidebar:"extensions",previous:{title:"HTML Reporter",permalink:"/docs/next/extensions/html_reporter.html"},next:{title:"Pitest",permalink:"/docs/next/extensions/pitest.html"}},c={},l=[],p={toc:l};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Kotest provides an ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kotest/kotest-extensions-mockserver"},"extension")," for integration with the ",(0,o.kt)("a",{parentName:"p",href:"https://www.mock-server.com"},"MockServer")," library."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Requires the ",(0,o.kt)("inlineCode",{parentName:"p"},"io.kotest:kotest-extensions-mockserver")," module to be added to your build.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Since Kotest 6.0, all extensions are published under the ",(0,o.kt)("inlineCode",{parentName:"p"},"io.kotest")," group once again, with version cadence tied to\nmain Kotest releases.")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://search.maven.org/artifact/io.kotest.extensions/kotest-extensions-mockserver"},(0,o.kt)("img",{src:"https://img.shields.io/maven-central/v/io.kotest/kotest-extensions-mockserver.svg?label=latest%20release"})),"\n",(0,o.kt)("a",{parentName:"p",href:"https://central.sonatype.com/repository/maven-snapshots/io/kotest/kotest-extensions-mockserver/maven-metadata.xml"},(0,o.kt)("img",{src:"https://img.shields.io/maven-metadata/v?metadataUrl=https%3A%2F%2Fcentral.sonatype.com%2Frepository%2Fmaven-snapshots%2Fio%2Fkotest%2Fkotest-extensions-mockserver%2Fmaven-metadata.xml"}))),(0,o.kt)("p",null,"Mockserver allows us to define an in process HTTP server which is hard coded for routes that we want to test against."),(0,o.kt)("p",null,"To use in Kotest, we attach an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"MockServerListener")," to the spec under test, and Kotest will control\nthe lifecycle automatically."),(0,o.kt)("p",null,"Then it is a matter of using ",(0,o.kt)("inlineCode",{parentName:"p"},"MockServerClient")," to wire in our responses."),(0,o.kt)("p",null,"For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'class MyMockServerTest : FunSpec() {\n  init {\n\n      // this attaches the server to the lifeycle of the spec\n      listener(MockServerListener(1080))\n\n      // we can use the client to create routes. Here we are setting them up\n      // before each test by using the beforeTest callback.\n      beforeTest {\n         MockServerClient("localhost", 1080).`when`(\n            HttpRequest.request()\n               .withMethod("POST")\n               .withPath("/login")\n               .withHeader("Content-Type", "application/json")\n               .withBody("""{"username": "foo", "password": "bar"}""")\n         ).respond(\n            HttpResponse.response()\n               .withStatusCode(202)\n               .withHeader("X-Test", "foo")\n         )\n      }\n\n      // this test will confirm the endpoint works\n      test("login endpoint should accept username and password json") {\n\n         // using the ktor client to send requests\n         val client = HttpClient(CIO)\n         val resp = client.post<io.ktor.client.statement.HttpResponse>("http://localhost:1080/login") {\n            contentType(ContentType.Application.Json)\n            body = """{"username": "foo", "password": "bar"}"""\n         }\n\n         // these handy matchers come from the kotest-assertions-ktor module\n         resp.shouldHaveStatus(HttpStatusCode.Accepted)\n         resp.shouldHaveHeader("X-Test", "foo")\n      }\n  }\n}\n')),(0,o.kt)("p",null,"In the above example, we are of course just testing the mock itself, but it shows how a real test could be configured. For example,\nyou may have an API client that you want to test, so you would configure the API routes using mock server, and then invoke methods\non your API client, ensuring it handles the responses correctly."))}m.isMDXComponent=!0}}]);